---
title: 迁移至新的短信连接器v2
description: 了解如何迁移至新的短信连接器v2
feature: Technote
role: Admin
source-git-commit: 6f29a7f157c167cae6d304f5d972e2e958a56ec8
workflow-type: tm+mt
source-wordcount: '796'
ht-degree: 0%

---

# 迁移至新的短信连接器v2

本文档概述了从Adobe Campaign v8中基于MTA的SMS连接器迁移到新的&#x200B;**专用SMS进程连接器**&#x200B;时的过程和关键注意事项。

## 为何切换到v2连接器

专用SMS过程引入对SMPP收发器模式的支持，减少连接计数并提高资源效率，同时如果需要，仍支持发送器/接收器设置。 它提供了显着增强的稳定性，能够更快地从错误中恢复，保持连接，并且不依赖本地文件或进程间通信。 性能也得到改善，具有更低的延迟、更高的吞吐量和智能微批处理，以平衡速度和可靠性。 此外，SMS过程的隔离简化了故障排除并最大限度地减少了跨渠道影响。 这些增强功能使专用连接器成为短信投放的一个更强健、可扩展的解决方案。

## v1和v2连接器的差异

与基于MTA的连接器相比，Adobe Campaign v8中的专用SMS连接器引入了几项体系结构更改。 一个关键区别是默认使用SMPP收发器模式，该模式通过组合发送和接收功能来减少连接数。 如果提供商不支持此模式，仍可以使用单独的发送器和接收器连接。 与MTA连接器不同，启用自动回复对连接数没有影响，并且所有接收方连接都可以处理任何类型的传入消息。

连接计数现在使用其他公式计算：

```
Total connections = SMS sending threads * Number of MTA child connections. 
```

在serverConf中定义的sendingThreads参数默认为1，除非特别针对高性能进行优化，否则通常应保持不变。 由于单个进程处理所有SMS流量，因此通过这些参数管理并行性对于控制系统负载和行为至关重要。

发送窗口的行为与MTA连接器类似，但在专用模式下对性能的影响甚至更大。 较大的发送窗口会降低数据库IOPS并提高吞吐量。 Campaign可以高效地处理超过1000条消息的窗口，前提是提供商支持这一点，并且用例允许在连接问题时留出很小的消息丢失或重复边距。 在提供商方面，配置更大的SR发送窗口也可以显着改善投放报告吞吐量。

最后，虽然MO(Mobile Arrained)消息处理在功能上保持不变，但底层代码已更新。 每个连接的吞吐量仍然受到同样的限制，但专用连接器支持更快的突发发送。 但是，如果没有吞吐量限制，高速发送可能会使提供商或系统资源不堪重负，因此建议在外部帐户配置中设置明确的MT吞吐量上限。

## 切换过程

为确保顺利切换到专用短信流程，最好在低短信流量或无短信流量时执行此操作。 如果MTA缓冲区未完全刷新，则某些缓冲的消息可能会丢失或处于无效状态。 由于无法预测的SR时间，在交换机后多达一周内丢失某些SR也是正常的。 即使内置了安全措施，不遵循这些预防措施仍可能会导致报文丢失或重复。

两个SMS连接器都使用不同的格式进行SR（状态报表）处理。 虽然两者都依赖于`NmsProviderMsgId`表，但它们与它的交互方式不同。 因此，切换连接器需要清除整个表以防止冲突或孤立数据。 有多种方法可执行此清理。 以下是您可以使用的SQL查询：

```
TRUNCATE TABLE NmsProviderMsgId;
TRUNCATE TABLE NmsProviderMsgStatus;
```

### 步骤

1. 查看`serverConf`设置(`sms > mta2`)。
1. 暂停实时消息准备工作流（如果适用）。
1. 暂停所有短信投放。
1. 禁用短信外部帐户。
1. 停止并重新启动MTA和短信进程。
1. 确保没有活动的SMPP连接。 如果存在，请确保暂停所有投放。
1. 清除数据库中`NmsProviderMsgId`和`NmsProviderMsgStatus`表的内容。
1. 在外部帐户中：
   * 启用“专用进程”复选框
   * 调整其他设置：MTA子连接、MT吞吐量、发送窗口
1. 重新启用外部帐户并保存。
1. 恢复短信投放。
1. 检查短信服务是否正常工作。

>[!NOTE]
>
>监测SMS、MTA和MTA子日志中的错误或问题。
>
>保存以前的外部帐户设置以进行回滚。

### 回滚过程

可以按照与初始切换期间使用的步骤相同的顺序，回滚到MTA连接器。 这包括停止或暂停所有SMS投放并恢复原始外部帐户配置。

1. 如果实例使用实时投放，请暂停负责准备这些消息的技术工作流。
1. 暂停所有短信投放。
1. 禁用短信外部帐户。
1. 停止并重新启动MTA和短信进程。
1. 请确保没有任何SMPP连接保持活动状态；如果保持活动状态，请验证所有投放均已正确暂停。
1. 清除数据库中的`NmsProviderMsgId`和`NmsProviderMsgStatus`表。
1. 在外部帐户中：
   * 取消选中外部帐户中的“专用进程”选项。
   * 恢复所有以前的外部帐户设置：MTA子连接、MT吞吐量、发送窗口
1. 重新启用并保存外部帐户。
1. 恢复所有短信投放。
1. 最后，确认短信服务运行正常。
